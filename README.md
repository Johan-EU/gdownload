# gdownload

This repository contains a Gmail bulk attachment downloader that downloads all attachments
from the messages of the specified Gmail query. The file name of the attachment is
used but if a file with the same name already exists in the output directory a unique filename
will be generated by attaching `(x)`  before the file extension (e.g. _picture(1).jpg_).\
Every downloaded attachtment will have a modification date that is equal to the moment the 
message was received by Gmail.

## Download

A compiled version of gdownload can be
[downloaded from the release section](https://github.com/Johan-EU/gdownload/releases) of
this project. The binary application has an embedded OAuth client ID. Be aware that it is 
possible to extract the client ID from the application so it is unwise to trust the 
application if downloaded from somewhere else than here.

## Build yourself
The alternative is to compile yourself. In that case you need to get the Gmail API Go
client library and OAuth2 package using the following commands:
```
go get -u google.golang.org/api/gmail/v1
go get -u golang.org/x/oauth2/google
```

Compile with executing `go build` in the directory containing your clone of the gdownload
repository.

The application needs access to the Gmail API. The sources do not include a registration 
so you have to do this yourself by going to the 
[developer console](https://console.developers.google.com/) and create a OAuth client ID.
Download a JSON credentials file for the application to use. By default the 
file `credentials.json` will be loaded but another files name can be specified with
the `--credentials-file` parameter. The `credentials.json` file can be embedded in the
application via the `go generate` command. A file named `credentials.go` will be generated. 
 
## Usage

```
gdownload [<options>] <search query> 
```
When gdownload is executed it will launch a web browser and display a Google page that 
requests the user to grant gdownload access to data in their Google account. If the user
allows access the application requests and receives credentials to access the Gmail API on
behalf of the user. These credentials can be cached locally in a file for subsequent
executions of the program by passing the argument `-cachetoken`. Default no caching
is done and the web page to grant access is displayed every time the program is started. 

Once started a line with the message subject is printed for every message and a seperate
line for every attachment with the unique file name of the attachment.
```
$ gdownload -o ~/tmp "label:foobar from:someone@gmail.com"
2019/06/14 16:35:41 Using cached token from "/home/demouser/.cache/gdownload-tok3831251668"
2019/06/14 16:35:42 Message #1: Test 3 attachments
2019/06/14 16:35:43 Message #1 attachment #1: picture.jpg
2019/06/14 16:35:43 Message #1 attachment #2: anotherpicture.jpg
2019/06/14 16:35:44 Message #1 attachment #3: picture(1).jpg
2019/06/14 16:35:44 Message #2: Some reading about foo and bar
2019/06/14 16:35:44 Message #2 attachment #1: foobar.pdf
2019/06/14 16:35:44 Downloaded 4 attachments from 2 messages
```
